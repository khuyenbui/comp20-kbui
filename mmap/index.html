<!DOCTYPE html>
<html>

        <head>
                <title>Marauder's map</title>
                <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
                <script src="http://maps.google.com/maps/api/js?sensor=true"></script>
                <link rel="stylesheet" href="marauder.css" />
                <script>
                        var myLat, myLng;
                        function init()
                        {
                                myLocation = new google.maps.LatLng(myLat, myLng);

                                // Set up map
                                var myOptions = {
                                        zoom: 13, // The larger the zoom number, the bigger the zoom
                                        center: myLocation,
                                        mapTypeId: google.maps.MapTypeId.ROADMAP
                                };

                                // Create the map in the "map_canvas" <div>
                                var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
                                // Create a marker
                                var marker = new google.maps.Marker({
                                        position: myLocation,
                                        title: "Tufts U, Medford, MA"
                                });
                                marker.setMap(map);

                                // I need to create a marker for every location so loop somewhere.

                                // This is a global info window...
                                var infowindow = new google.maps.InfoWindow();

                                // Open info window on click of marker
                                google.maps.event.addListener(marker, 'click', function() {
                                        infowindow.setContent(marker.title);
                                        infowindow.open(map, marker);
                                });
                        console.log('After setting up map');
                        // step 1: get my location
                       function success(pos) {
                               crd = pos.coords;
                               myLat = crd.latitude;
                               myLng = crd.longitude;
                               console.log('Latitude : ' + crd.latitude);
                               console.log('Longitude: ' + crd.longitude);
                        //  send my location to datastore using POST
                                params = "login=khuyenbui&lat=" + myLat + "&lng=" + myLng;
                                xhr = new XMLHttpRequest();
                                xhr.open("POST", "https://secret-about-box.herokuapp.com/sendLocation", true);
                                xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                                xhr.onreadystatechange = parseData();
                                xhr.send(params);
                                }
                                geo = navigator.geolocation;
                                geo.getCurrentPosition(success);
                                console.log('After get my location');
                        //
                        //  retrieve others' location.
                        function parseData()
                        {
                                console.log('in parseData');
                                if (xhr.readyState == 4 && xhr.status == 200) { // good respnse
                                        converted = JSON.parse(xhr.responseText);
                                        console.log('good response');
                                        for (i = 0; i < converted.length; i++) {
                                                console.log('what do I get');
                                                aLat = converted[i]['lat'];
                                                aLng = converted[i]['lng'];
                        //    messagesDiv.innerHTML += '<p>' + converted[i]['content'];
                                        }
                                }
                        // create marker
                        // info window for each location: login and distance
                        }
                        // display their locations
                    }
                </script>
        </head>

        <body onload="init()">
                <div id="map_canvas"></div>
        </body>
</html>